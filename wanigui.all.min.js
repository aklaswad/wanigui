(function(){"use strict";var n;n=function(n,t){return this.init(n,t)},n.modules={},n.registerModule=function(t){var i,e,o,s,a,r,l;if(n.modules[t.name]=t,null!=t.stylesheet){for(l=$("<style />").appendTo($("head").eq(0)).get(0).sheet,r=t.stylesheet.split(/}/).reverse(),s=[],i=e=0,o=r.length;o>e;i=++e)a=r[i],a=a.replace(/^[\s\n]+/g,""),a=a.replace(/^[\s\n]+$/g,""),a&&(a.match(/}$/)||(a+="}"),s.push(l.insertRule(a,0)));return s}},n.prototype.Defaults={},n.prototype.init=function(n,t){var i,e,o,s,a;this.opts=$.extend({},this.Defaults,t),this.audioParams={},this.params={},this.module=n,this.instrument,this.profile=o=n.profile,this.attachToModule(n,o,t),"synth"===o.type&&this.attachToInstrument(n,o,t),s=o.audioParams;for(i in s)e=s[i],this.attachToAudioParam(n,i,e,this.opts);a=o.params;for(i in a)e=a[i],this.attachToParam(n,i,e,this.opts);return this},n.prototype.attachToModule=function(t){var i,e,o,s,a;for(a=this.module.looks||[],a.push("module-basic"),e=0,o=a.length;o>e;e++)if(s=a[e],i=n.modules[s])return void(this.moduleBuilder=new i.create(t,this.opts))},n.prototype.attachToInstrument=function(t){var i,e,o,s,a;for(a=this.module.instrumentLooks||[],a.push("keyboard"),e=0,o=a.length;o>e;e++)if(s=a[e],i=n.modules[s])return void(this.instrument=new i.create(t,this.opts))},n.prototype.attachToAudioParam=function(t,i,e,o){var s,a,r,l,u;for(u=e.looks||[],u.push("knob"),a=0,r=u.length;r>a;a++)if(l=u[a],s=n.modules[l])return void(this.audioParams[i]=new s.create(t,i,e,o))},n.prototype.attachToParam=function(t,i,e,o){var s,a,r,l,u;for(u=e.looks||[],u.push("knob"),a=0,r=u.length;r>a;a++)if(l=u[a],s=n.modules[l])return void(this.params[i]=new s.create(t,i,e,o))},n.prototype.applyPreset=function(n){var t,i,e,o,s;t=this.profile.presets[n],i=t.audioParams;for(n in i)s=i[n],this.audioParams[n].value=s;e=t.params,o=[];for(n in e)s=e[n],o.push(this.params[n].value=s);return o},n.prototype.build=function(){return this.moduleBuilder.build(this)},window.Wanigui=n}).call(this),function(){var n;n=function(n,t){return this.module=n,this.profile=n.profile,this.opts=t,this},n.prototype=Object.create(Wanigui.prototype),n.prototype.build=function(n){var t,i,e,o,s,a,r,l,u,h,d,p,f,b;if(f=this,u=this.module.profile,t=$('<div class="wanigui-module" />'),e=$('<section class="wanigui-module-wrapper" />').append(t),$("<h1 />").addClass(".wanigui-module-name").text(this.profile.name).appendTo(t),"synth"===u.type&&t.addClass("wanigui-synth"),u.presets){o=$('<select class="presets"/>'),h=u.presets,a=function(n){var t;return t=$("<option />").text(n).appendTo(o)};for(r in h)b=h[r],a(r);o.on("change",function(){return n.applyPreset(o.val())}),o.appendTo(t)}n.instrument&&(i=n.instrument.build(),i.addClass("wanigui-inst"),t.append(i)),d=n.audioParams;for(r in d)s=d[r],t.append(s.build());p=n.params;for(r in p)l=p[r],t.append(l.build());return e},Wanigui.registerModule({name:"module-basic",create:n,stylesheet:"\n.wanigui-module-wrapper {\n  width: 260px;\n}\n\n.wanigui-module {\n  border: 1px solid #888;\n  background-color: #808a90;\n  color: #fff;\n  position: relative;\n  width: 100%;\n  margin: 2px;\n}\n\n.wanigui-module-name {\n  display: block;\n  width: 100%;\n  text-align: center;\n}\n\n.wanigui-module.wanigui-synth {\n  background-color: #80908a;\n}\n\n.wanigui-module h1 {\n  color: #fff;\n  padding: 3px 3px 3px 20px;\n  margin: 8px 2px;;\n  font-size: 16px;\n}\n\n.wanigui-inst {\n  margin: 5px 0;\n}\n\n.wani-module .js-remove-module {\n  float: right;\n  position: absolute;\n  right: 5px;\n  top: 5px;\n  color: #def;\n}\n\n.wani-module .js-toggle-knobs {\n  position: absolute;\n  left: 5px;\n  top: 5px;\n  color: #def;\n}\n"})}.call(this),function(){var n,t,i;n=function(n,t,i,e){return this.init(n,t,i,e)},n.prototype.init=function(n,t,i,e){return this.module=n,this.name=t,this.param=i,this.opts=e,this.isSelect=null!=i.values?!0:!1,this.values=i.values,this.sense=e.sense||200,this.isSelect?(this.step=1,Object.defineProperty(this,"value",{set:function(n){var i;return i=this.values.indexOf(n),0>i?void 0:(this._value=i,this.module[t]=n,this.rotate())},get:function(){return this.values[this._value]}}),this.defaultValue=this.values[0]):(this.min=i.range[0],this.max=i.range[1],this.step=this.opts.step||this.range/this.sense,Object.defineProperty(this,"value",{set:function(n){return this.min<=n&&n<=this.max?(n=Math.round(1*n/this.step)*this.step,this._value=n,null!=this.module[t].value?this.module[t].value=n:this.module[t]=n,this.rotate()):void 0},get:function(){return this._value}}),this.defaultValue=null!=this.module[t].value?this.module[t].value:this.module[t]),this},n.Defaults={min:0,max:1},n.prototype.template=function(n){return'<div class="wani-knob-box wani-knob">\n  <div class="wani-knob-inner">\n    <h2 class="wani-knob-title">\n      <span>'+n.title+'</span>\n    </h2>\n    <canvas class="wani-knob-backsheet" width="160" height="160"></canvas>\n    <div class="wani-knob-activevalue">'+n.value+'</div>\n    <div class="wani-knob-value">'+n.value+'</div>\n    <div class="wani-knob-knob">\n      <div class="wani-knob-point"></div>\n    </div>\n  </div>\n</div>'},n.prototype.build=function(){var t,i,e,o,s,a,r,l,u;for(this.opts=$.extend({},n.Defaults,this.param,this.opts),this.canvasMargin=48,this.values=void 0,this.range=void 0,this.isSelect=null!=this.opts.values,this.isSelect?(this.values=this.opts.values,this.min=0,this.max=this.opts.values.length-1,this.range=[0,this.opts.values.length-1],this.multiplier=.05,this._value=0,this.step=1):(this.values=this.opts.range,this.min=this.opts.range[0],this.max=this.opts.range[1],this.range=Math.abs(this.max-this.min),this.multiplier=this.range/this.sense,this.step=this.opts.step||this.range/300),this.baseTheta=240*Math.PI/360*2,o=this.template({title:this.name,value:this.value}),t=$(o),this.box=t,i=t.find(".wani-knob-backsheet").get(0),i.tipWidth=52,i.tipHeight=18,i.radius=(i.width-i.tipWidth)/2,e=i.getContext("2d"),e.fillStyle="#889",e.textAlign="center",e.textBaseline="middle",s=0,a=this.values.length;a>s;)r=this.values[s],l=i.width/2+i.radius*Math.cos(this.baseTheta-2*s/(a-1)*Math.PI*300/360),u=i.height/2-i.radius*Math.sin(this.baseTheta-2*s/(a-1)*Math.PI*300/360),e.strokeStyle="#fff",e.beginPath(),e.moveTo(l,u),e.lineTo(i.width/2,i.height/2),e.stroke(),e.fillStyle="#789",e.fillRect(l-i.tipWidth/2,u-i.tipHeight/2,i.tipWidth,i.tipHeight),e.strokeRect(l-i.tipWidth/2,u-i.tipHeight/2,i.tipWidth,i.tipHeight),e.fillStyle="#fff",e.font='normal lighter 14px "Courier New", arial',e.fillText(r,l,u,i.tipWidth-2),s++;return t.data("wanigui-knob",this),this.value=this.defaultValue,t},n.prototype.rotate=function(){var n,t,i,e,o;if(this.box)return e=Math.round(1*this._value/this.step)*this.step,n=Math.abs(this.max-this.min),t=Math.abs(e-this.min)/n,i=300*(t-.5),this.box.find(".wani-knob-knob").css({transform:"rotate("+i+"deg)"}),o=this.isSelect?this.value:this.value.toFixed(6).substr(0,7),this.box.find(".wani-knob-activevalue").text(o),this.box.find(".wani-knob-value").text(o)},i=function(n){$(n).on("mousedown",".wani-knob-knob",function(t){var i,e,o,s,a,r,l,u,h,d;return $("body").addClass("wani-no-select wani-grabbing"),a=$(this),a.addClass("wani-knob-active"),o=a.parents(".wani-knob-box"),r=o.data("wanigui-knob"),l={x:t.pageX,y:t.pageY},h=r.isSelect?r._value:r.value,u=h,i=a.siblings(".wani-knob-activevalue").show(),e=a.siblings(".wani-knob-backsheet").show(),s=a.siblings(".wani-knob-value").hide(),d=function(n){var t,i,e,o;return i={x:n.pageX,y:n.pageY},t={x:i.x-l.x,y:i.y-l.y},o=h-t.y*r.multiplier,r.max<=o&&(o=r.max),o<=r.min&&(o=r.min),l=i,r.isSelect?(e=Math.round(o),u!==e&&(r.value=r.values[e],u=e)):h!==o&&(r.value=o),h=o,!1},$(n).on("mousemove",d),$(n).on("mouseup",function(){return $("body").removeClass("wani-no-select wani-grabbing"),a.removeClass("wani-knob-active"),i.hide(),e.hide(),s.show(),$(n).off("mousemove",d),!0}),!1})},t=".wani-knob-box {\n  width: 64px;\n  height: 64px;\n  text-align: center;\n  display: inline-block;\n  margin-bottom: 16px;\n}\n\n.wani-knob-inner {\n  position: relative;\n  margin-left: -2px;\n  width: 100%;\n  height: 100%;\n}\n\n.wani-knob-backsheet {\n  position: absolute;\n  left: -48px;\n  top: -48px;\n  z-index: 300;\n  display: none;\n}\n\n.wani-knob-knob {\n  border: 1px solid #abc;\n  z-index: 200;\n}\n\n.wani-knob-knob.wani-knob-active {\n  box-shadow: 0 0 5px #def;\n  border: 1px solid #fff;\n  background-color: #abc;\n  z-index: 400;\n}\n\n.wani-knob-knob.wani-knob-active .wani-knob-point {\n  box-shadow: 0 0 5px #def;\n  border: 1px solid #fff;\n  background-color: #abc;\n  z-index: 400;\n}\n\n.wani-knob-knob {\n  position: absolute;\n  left: 16px;\n  width: 32px;\n  height: 32px;\n  border-radius: 16px;\n  background-color: #8f8073;\n  cursor: pointer;\n}\n\n.wani-knob-point {\n  position: absolute;\n  left: 13px;\n  top: 0px;\n  width: 6px;\n  height: 6px;\n  border-radius: 3px;\n  background-color: #f84;\n  z-index: 9;\n}\n\n.wani-knob-title {\n  margin: 0;\n  padding: 0;\n  overflow: hidden;\n}\n\n.wani-knob-title span {\n  font-size: 11px;\n  color: #fff;\n  margin: 0;\n  padding: 0;\n  vertical-align: top;\n  display: inline-block;\n}\n\n.wani-knob-value {\n  text-align: center;\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  display: block;\n  vertical-align: top;\n  font-size: 0.8em;\n  overflow: hidden;\n}\n\n.wani-knob-activevalue {\n  position: absolute;\n  bottom: -50px;\n  width: 100%;\n  z-index: 1000000;\n  overflow: hidden;\n  display: none;\n  background-color: #789;\n  color: #fff;\n  border: 1px solid #def;\n  text-align: center;\n  height: 24px;\n}",i(document),Wanigui.registerModule({name:"knob",create:n,stylesheet:t})}.call(this),function(){var n,t;n=function(n,t,i){return this.init(n,t,i),this},n.prototype.init=function(n){return this.destination=n,this.width=256,this.height=80},n.prototype.Defaults={keyWidth:17,width:256,height:32},n.prototype.build=function(){var n;return n=$("<div />").addClass("wani-kb").css({height:this.height,width:this.width}),this.$keyboard=n,this.buildKeyboard(n,48),n},n.prototype.buildKeyboard=function(n,t){var i,e,o,s,a,r,l,u,h,d,p,f,b,c,m,g,w,k,v,x;for(h=this,x=this.width,s=this.height,p=25,t=48,i={1:1,3:1,6:1,8:1,10:1},r=function(n){return i[n%12]},k={},e={},v=0,a=0,f=t;p+t>f;)r(f)?e[v]=f:k[v++]=f,a++,f++;for(d=x/v,o=function(t,i){return $("<div />").addClass("wani-kb-bk wani-kb-key wani-kb-key-"+t).css({width:.7*d,height:.6*s,left:i*d-.35*d}).on("mousedown",function(){return h.onmousedown(t),!1}).appendTo(n)},c=l=0,m=v-1;m>=0?m>=l:l>=m;c=m>=0?++l:--l)b=e[c],b&&o(b,c);for(w=[],c=u=0,g=v-1;g>=0?g>=u:u>=g;c=g>=0?++u:--u)b=k[c],w.push(function(t,i){return $("<div />").addClass("wani-kb-wk wani-kb-key wani-kb-key-"+t).css({width:d,height:s-2,left:i*d}).on("mousedown",function(){return h.onmousedown(t),!1}).appendTo(n)}(b,c));return w},n.prototype.onmousedown=function(n){return this.noteOn(n),null==this.playing&&($(document).addClass("wani-no-select"),this.setNoteOffListeners()),this.playing=n},n.prototype.noteOn=function(n){return this.$keyboard.find(".wani-kb-key-"+n).addClass("wani-kb-key-playing"),this.destination.noteOn(n)},n.prototype.noteOff=function(n){return null==n&&(n=this.playing),this.$keyboard.find(".wani-kb-key-"+n).removeClass("wani-kb-key-playing"),this.destination.noteOff(n)},n.prototype.setNoteOffListeners=function(){var n;n=this,this.mouseup=function(){return n.noteOff(n.playing),n.playing=null,$(document).removeClass("wani-no-select"),n.clearNoteOffListeners(),!1},$(document).on("mouseup",this.mouseup),this.$keyboard.on("mouseleave",function(){return n.noteOff(n.playing),!1}),this.$keyboard.find(".wani-kb-key").on("mouseenter",function(){return n.noteOff(n.playing),$(this).trigger("mousedown"),!1})},n.prototype.clearNoteOffListeners=function(){return $(document).off("mouseup",this.mouseup),this.$keyboard.off("mouseleave"),this.$keyboard.find(".wani-kb-key").off("mouseenter")},t=".wani-no-select {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n}\n\n.wani-grabbing {\n  cursor: move !important;\n}\n\n.wani-kb {\n  height: 70px;\n  width: 256px;\n  position: relative;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n  cursor: pointer;\n  background-color: #abc;\n}\n\n.wani-kb-wk {\n  position: absolute;\n  top: 0px;\n  border-right: 1px solid #abc;\n  border-bottom: 2px solid #424033;\n  background-color: #8f8073;\n  border-radius: 0 0 2px 2px;\n  z-index: 2;\n}\n\n.wani-kb-bk {\n  height: 60%;\n  position: absolute;\n  top: 0px;\n  border-right: 1px solid #abc;\n  background-color: #f84;\n  border-radius: 0 0 2px 2px;\n  z-index: 4;\n}\n\n.wani-kb-bk:hover {\n  background-color: #fca;\n}\n\n.wani-kb-wk:hover {\n  background-color: #654;\n}\n\n.wani-kb-key-playing {\n  background-color: #abc !important;\n}\n\n.wani-kb-key-playing.wani-kb-wk {\n  z-index: 3;\n  border-left: 1px solid #fff;\n  border-right: 1px solid #fff;\n  border-bottom: 1px solid #fff;\n  box-shadow: 0 0 5px #def;\n}\n\n.wani-kb-key-playing.wani-kb-bk {\n  border-left: 1px solid #fff;\n  border-right: 1px solid #fff;\n  border-bottom: 1px solid #fff;\n  box-shadow: 0 0 5px #def;\n}\n",Wanigui.registerModule({name:"keyboard",create:n,stylesheet:t})}.call(this);