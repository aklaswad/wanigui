(function(){"use strict";var n;n=function(n,t){return this.init(n,t)},n.modules={},n.registerModule=function(t){var i,e,o,a,s,r,l;if(n.modules[t.name]=t,null!=t.stylesheet){for(l=$("<style />").appendTo($("head").eq(0)).get(0).sheet,r=t.stylesheet.split(/}/).reverse(),a=[],i=e=0,o=r.length;o>e;i=++e)s=r[i],s=s.replace(/^[\s\n]+/g,""),s=s.replace(/^[\s\n]+$/g,""),s&&(s.match(/}$/)||(s+="}"),a.push(l.insertRule(s,0)));return a}},n.prototype.Defaults={},n.prototype.init=function(n,t){var i,e,o,a,s;this.opts=$.extend({},this.Defaults,t),this.audioParams={},this.params={},this.module=n,this.instrument,this.profile=o=n.profile,this.attachToModule(n,o,t),"synth"===o.type&&this.attachToInstrument(n,o,t),a=o.audioParams;for(i in a)e=a[i],this.attachToAudioParam(n,i,e,this.opts);s=o.params;for(i in s)e=s[i],this.attachToParam(n,i,e,this.opts);return this},n.prototype.attachToModule=function(t){var i,e,o,a,s;for(s=this.module.looks||[],s.push("module-basic"),e=0,o=s.length;o>e;e++){if(a=s[e],"none"===a)return;if(i=n.modules[a])return void(this.moduleBuilder=new i.create(t,this.opts))}},n.prototype.attachToInstrument=function(t){var i,e,o,a,s;for(s=this.module.instrumentLooks||[],s.push("keyboard"),e=0,o=s.length;o>e;e++){if(a=s[e],"none"===a)return;if(i=n.modules[a])return void(this.instrument=new i.create(t,this.opts))}},n.prototype.attachToAudioParam=function(t,i,e,o){var a,s,r,l,u;for(u=e.looks||[],u.push("knob"),s=0,r=u.length;r>s;s++){if(l=u[s],"none"===l)return;if(a=n.modules[l])return void(this.audioParams[i]=new a.create(t,i,e,o))}},n.prototype.attachToParam=function(t,i,e,o){var a,s,r,l,u;for(u=e.looks||[],u.push("knob"),s=0,r=u.length;r>s;s++)if(l=u[s],a=n.modules[l])return void(this.params[i]=new a.create(t,i,e,o))},n.prototype.applyPreset=function(n){var t,i,e,o,a;t=this.profile.presets[n],i=t.audioParams;for(n in i)a=i[n],this.audioParams[n].value=a;e=t.params,o=[];for(n in e)a=e[n],o.push(this.params[n].value=a);return o},n.prototype.build=function(){return this.moduleBuilder.build(this)},window.Wanigui=n}).call(this),function(){var n;n=function(n,t){return this.module=n,this.profile=n.profile,this.opts=t,this},n.prototype=Object.create(Wanigui.prototype),n.prototype.build=function(n){var t,i,e,o,a,s,r,l,u,h,p,d,f,b,c,g,m,w,k,x,v,y,T;if(y=this,w=this.module.profile,i=$('<div class="wanigui-module" />'),a=$('<section class="wanigui-module-wrapper" />').append(i),l=$("<span />").text("-").addClass("wanigui-toggle-params").on("click",function(){return o.toggle(),$(this).text("+"===$(this).text()?"-":"+")}),r=$("<h1 />").addClass("wanigui-module-title").append(l).append($("<span />").addClass("wanigui-module-name").text(this.profile.name)).appendTo(i),"synth"===w.type&&i.addClass("wanigui-synth"),w.presets){s=$('<select class="presets"/>'),k=w.presets,h=function(n){var t;return t=$("<option />").text(n).appendTo(s)};for(c in k)T=k[c],h(c);s.on("change",function(){return n.applyPreset(s.val())}),s.appendTo(r)}n.instrument&&(e=n.instrument.build(),e.addClass("wanigui-inst"),i.append(e)),o=$("<div />").addClass("wanigui-parameters"),d={ZZZZZ__other:[]},x=n.audioParams;for(c in x)u=x[c],console.log(c,u),p=w.audioParams[c].group||"ZZZZZ__other",null==d[p]&&(d[p]=[]),d[p].push({name:c,param:u});v=n.params;for(c in v)g=v[c],p=w.params[c].group||"ZZZZZ__other",null==d[p]&&(d[p]=[]),d[p].push({name:c,param:g});for(p in d){for(m=d[p],"ZZZZZ__other"===p&&(p="other"),t=$('<div class="wani-param-group" />').addClass("group-"+p),"other"!==p&&t.append($("<h2 />").text(p)),f=0,b=m.length;b>f;f++)g=m[f],t.append(g.param.build());t.appendTo(o)}return a.append(o)},Wanigui.registerModule({name:"module-basic",create:n,stylesheet:"\n.wanigui-module-wrapper {\n  width: 590px;\n  background-color: #f84;\n  border: 1px solid #888;\n  background-color: #808a90;\n  color: #fff;\n  position: relative;\n  width: 100%;\n  margin: 2px;\n  text-align: center;\n}\n\n.wanigui-module-title {\n  height: 30px;\n}\n\n.wanigui-module-name {\n  position: absolute;\n  left: 24px;\n}\n\n.wanigui-module h1 {\n  color: #fff;\n  padding: 3px 3px 3px 20px;\n  margin: 8px 2px;;\n  font-size: 16px;\n  text-align: left;\n}\n\nselect.presets {\n  border: 1px solid #fff;\n  color: #def;\n  width: 120px;\n  background-color: #678;\n  font-size: 10px;\n  font-weight: bold;\n  padding: 2px 10px;\n  position: absolute;\n  right: 8px;\n}\n\n.wanigui-toggle-params {\n  margin: 0 6px;\n  cursor: pointer;\n  position: absolute;\n  left: 3px;\n}\n\n.wanigui-inst {\n  display: inline-block;\n  margin: 5px 0;\n}\n\n.wanigui-parameters {\n  text-align: left;\n  padding: 8px;\n}\n\n.wani-param-group {\n  position: relative;\n  display: inline-block;\n  margin-bottom: 10px;\n}\n\n.wani-param-group h2 {\n  font-size: 10px;\n  text-align: center;\n  margin: 2px;\n  color: #abc;\n  border-bottom: 1px solid #abc;\n}\n\n.wani-module .js-remove-module {\n  float: right;\n  position: absolute;\n  right: 5px;\n  top: 5px;\n  color: #def;\n}\n\n.wani-module .js-toggle-knobs {\n  position: absolute;\n  left: 5px;\n  top: 5px;\n  color: #def;\n}\n"})}.call(this),function(){var n,t,i;n=function(n,t,i,e){return this.init(n,t,i,e)},n.prototype.init=function(n,t,i,e){return this.module=n,this.name=t,this.param=i,this.opts=e,this.isSelect=null!=i.values?!0:!1,this.values=i.values,this.sense=e.sense||200,this.isSelect?(this.step=1,Object.defineProperty(this,"value",{set:function(n){var i;return i=this.values.indexOf(n),0>i?void 0:(this._value=i,this.module[t]=n,this.rotate())},get:function(){return this.values[this._value]}}),this.defaultValue=this.values[0]):(this.min=i.range[0],this.max=i.range[1],this.step=this.opts.step||this.range/this.sense,Object.defineProperty(this,"value",{set:function(n){return this.min<=n&&n<=this.max?(n=Math.round(1*n/this.step)*this.step,this._value=n,null!=this.module[t].value?this.module[t].value=n:this.module[t]=n,this.rotate()):void 0},get:function(){return this._value}}),this.defaultValue=null!=this.module[t].value?this.module[t].value:this.module[t]),this},n.Defaults={min:0,max:1},n.prototype.template=function(n){return'<div class="wani-knob-box wani-knob">\n  <div class="wani-knob-inner">\n    <h3 class="wani-knob-title">\n      <span>'+n.title+'</span>\n    </h3>\n    <canvas class="wani-knob-backsheet" width="160" height="160"></canvas>\n    <div class="wani-knob-activevalue">'+n.value+'</div>\n    <div class="wani-knob-value">'+n.value+'</div>\n    <div class="wani-knob-knob">\n      <div class="wani-knob-point"></div>\n    </div>\n  </div>\n</div>'},n.prototype.build=function(){var t,i,e,o,a,s,r,l,u;for(this.opts=$.extend({},n.Defaults,this.param,this.opts),this.canvasMargin=48,this.values=void 0,this.range=void 0,this.isSelect=null!=this.opts.values,this.isSelect?(this.values=this.opts.values,this.min=0,this.max=this.opts.values.length-1,this.range=[0,this.opts.values.length-1],this.multiplier=.05,this._value=0,this.step=1):(this.values=this.opts.range,this.min=this.opts.range[0],this.max=this.opts.range[1],this.range=Math.abs(this.max-this.min),this.multiplier=this.range/this.sense,this.step=this.opts.step||this.range/300),this.baseTheta=240*Math.PI/360*2,o=this.template({title:this.name,value:this.value}),t=$(o),this.box=t,i=t.find(".wani-knob-backsheet").get(0),i.tipWidth=52,i.tipHeight=18,i.radius=(i.width-i.tipWidth)/2,e=i.getContext("2d"),e.fillStyle="#889",e.textAlign="center",e.textBaseline="middle",a=0,s=this.values.length;s>a;)r=this.values[a],l=i.width/2+i.radius*Math.cos(this.baseTheta-2*a/(s-1)*Math.PI*300/360),u=i.height/2-i.radius*Math.sin(this.baseTheta-2*a/(s-1)*Math.PI*300/360),e.strokeStyle="#fff",e.beginPath(),e.moveTo(l,u),e.lineTo(i.width/2,i.height/2),e.stroke(),e.fillStyle="#789",e.fillRect(l-i.tipWidth/2,u-i.tipHeight/2,i.tipWidth,i.tipHeight),e.strokeRect(l-i.tipWidth/2,u-i.tipHeight/2,i.tipWidth,i.tipHeight),e.fillStyle="#fff",e.font='normal lighter 14px "Courier New", arial',e.fillText(r,l,u,i.tipWidth-2),a++;return t.data("wanigui-knob",this),this.value=this.defaultValue,t},n.prototype.rotate=function(){var n,t,i,e,o;if(this.box)return e=Math.round(1*this._value/this.step)*this.step,n=Math.abs(this.max-this.min),t=Math.abs(e-this.min)/n,i=300*(t-.5),this.box.find(".wani-knob-knob").css({transform:"rotate("+i+"deg)"}),o=this.isSelect?this.value:this.value.toFixed(6).substr(0,7),this.box.find(".wani-knob-activevalue").text(o),this.box.find(".wani-knob-value").text(o)},i=function(n){$(n).on("mousedown",".wani-knob-knob",function(t){var i,e,o,a,s,r,l,u,h,p;return $("body").addClass("wani-no-select wani-grabbing"),s=$(this),s.addClass("wani-knob-active"),o=s.parents(".wani-knob-box"),r=o.data("wanigui-knob"),l={x:t.pageX,y:t.pageY},h=r.isSelect?r._value:r.value,u=h,i=s.siblings(".wani-knob-activevalue").show(),e=s.siblings(".wani-knob-backsheet").show(),a=s.siblings(".wani-knob-value").hide(),p=function(n){var t,i,e,o;return i={x:n.pageX,y:n.pageY},t={x:i.x-l.x,y:i.y-l.y},o=h-t.y*r.multiplier,r.max<=o&&(o=r.max),o<=r.min&&(o=r.min),l=i,r.isSelect?(e=Math.round(o),u!==e&&(r.value=r.values[e],u=e)):h!==o&&(r.value=o),h=o,!1},$(n).on("mousemove",p),$(n).on("mouseup",function(){return $("body").removeClass("wani-no-select wani-grabbing"),s.removeClass("wani-knob-active"),i.hide(),e.hide(),a.show(),$(n).off("mousemove",p),!0}),!1})},t=".wani-knob-box {\n  width: 64px;\n  height: 64px;\n  text-align: center;\n  display: inline-block;\n  margin-bottom: 16px;\n}\n\n.wani-knob-inner {\n  position: relative;\n  margin-left: -2px;\n  width: 100%;\n  height: 100%;\n}\n\n.wani-knob-backsheet {\n  position: absolute;\n  left: -48px;\n  top: -48px;\n  z-index: 300;\n  display: none;\n}\n\n.wani-knob-knob {\n  border: 1px solid #abc;\n  z-index: 200;\n}\n\n.wani-knob-knob.wani-knob-active {\n  box-shadow: 0 0 5px #def;\n  border: 1px solid #fff;\n  background-color: #abc;\n  z-index: 400;\n}\n\n.wani-knob-knob.wani-knob-active .wani-knob-point {\n  box-shadow: 0 0 5px #def;\n  border: 1px solid #fff;\n  background-color: #abc;\n  z-index: 400;\n}\n\n.wani-knob-knob {\n  position: absolute;\n  left: 16px;\n  width: 32px;\n  height: 32px;\n  border-radius: 16px;\n  background-color: #8f8073;\n  cursor: pointer;\n}\n\n.wani-knob-point {\n  position: absolute;\n  left: 13px;\n  top: 0px;\n  width: 6px;\n  height: 6px;\n  border-radius: 3px;\n  background-color: #f84;\n  z-index: 9;\n}\n\n.wani-knob-title {\n  margin: 0;\n  padding: 0;\n  overflow: hidden;\n}\n\n.wani-knob-title span {\n  font-size: 11px;\n  color: #fff;\n  margin: 0;\n  padding: 0;\n  vertical-align: top;\n  display: inline-block;\n}\n\n.wani-knob-value {\n  text-align: center;\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  display: block;\n  vertical-align: top;\n  font-size: 0.8em;\n  overflow: hidden;\n}\n\n.wani-knob-activevalue {\n  position: absolute;\n  bottom: -50px;\n  width: 100%;\n  z-index: 1000000;\n  overflow: hidden;\n  display: none;\n  background-color: #789;\n  color: #fff;\n  border: 1px solid #def;\n  text-align: center;\n  height: 24px;\n}",i(document),Wanigui.registerModule({name:"knob",create:n,stylesheet:t})}.call(this),function(){var n,t;n=function(n,t,i){return this.init(n,t,i),this},n.prototype.init=function(n){return this.destination=n,this.width=256,this.height=80},n.prototype.Defaults={keyWidth:17,width:256,height:32},n.prototype.build=function(){var n;return n=$("<div />").addClass("wani-kb").css({height:this.height,width:this.width}),this.$keyboard=n,this.buildKeyboard(n,48),n},n.prototype.buildKeyboard=function(n,t){var i,e,o,a,s,r,l,u,h,p,d,f,b,c,g,m,w,k,x,v;for(h=this,v=this.width,a=this.height,d=25,t=48,i={1:1,3:1,6:1,8:1,10:1},r=function(n){return i[n%12]},k={},e={},x=0,s=0,f=t;d+t>f;)r(f)?e[x]=f:k[x++]=f,s++,f++;for(p=v/x,o=function(t,i){return $("<div />").addClass("wani-kb-bk wani-kb-key wani-kb-key-"+t).css({width:.7*p,height:.6*a,left:i*p-.35*p}).on("mousedown",function(){return h.onmousedown(t),!1}).appendTo(n)},c=l=0,g=x-1;g>=0?g>=l:l>=g;c=g>=0?++l:--l)b=e[c],b&&o(b,c);for(w=[],c=u=0,m=x-1;m>=0?m>=u:u>=m;c=m>=0?++u:--u)b=k[c],w.push(function(t,i){return $("<div />").addClass("wani-kb-wk wani-kb-key wani-kb-key-"+t).css({width:p,height:a-2,left:i*p}).on("mousedown",function(){return h.onmousedown(t),!1}).appendTo(n)}(b,c));return w},n.prototype.onmousedown=function(n){return this.noteOn(n,.8),null==this.playing&&($(document).addClass("wani-no-select"),this.setNoteOffListeners()),this.playing=n},n.prototype.noteOn=function(n,t){return this.$keyboard.find(".wani-kb-key-"+n).addClass("wani-kb-key-playing"),this.destination.noteOn(n,t)},n.prototype.noteOff=function(n){return null==n&&(n=this.playing),this.$keyboard.find(".wani-kb-key-"+n).removeClass("wani-kb-key-playing"),this.destination.noteOff(n)},n.prototype.setNoteOffListeners=function(){var n;n=this,this.mouseup=function(){return n.noteOff(n.playing),n.playing=null,$(document).removeClass("wani-no-select"),n.clearNoteOffListeners(),!1},$(document).on("mouseup",this.mouseup),this.$keyboard.on("mouseleave",function(){return n.noteOff(n.playing),!1}),this.$keyboard.find(".wani-kb-key").on("mouseenter",function(){return n.noteOff(n.playing),$(this).trigger("mousedown"),!1})},n.prototype.clearNoteOffListeners=function(){return $(document).off("mouseup",this.mouseup),this.$keyboard.off("mouseleave"),this.$keyboard.find(".wani-kb-key").off("mouseenter")},t=".wani-no-select {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n}\n\n.wani-grabbing {\n  cursor: move !important;\n}\n\n.wani-kb {\n  height: 70px;\n  width: 256px;\n  position: relative;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n  cursor: pointer;\n  background-color: #abc;\n}\n\n.wani-kb-wk {\n  position: absolute;\n  top: 0px;\n  border-right: 1px solid #abc;\n  border-bottom: 2px solid #424033;\n  background-color: #ddd;\n  border-radius: 0 0 2px 2px;\n  z-index: 2;\n}\n\n.wani-kb-bk {\n  height: 60%;\n  position: absolute;\n  top: 0px;\n  border-right: 1px solid #abc;\n  background-color: #444;\n  border-radius: 0 0 2px 2px;\n  z-index: 4;\n}\n\n.wani-kb-bk:hover {\n  background-color: #777;\n}\n\n.wani-kb-wk:hover {\n  background-color: #aaa;\n}\n\n.wani-kb-key-playing {\n  background-color: #abc !important;\n}\n\n.wani-kb-key-playing.wani-kb-wk {\n  z-index: 3;\n  border-left: 1px solid #fff;\n  border-right: 1px solid #fff;\n  border-bottom: 1px solid #fff;\n  box-shadow: 0 0 5px #def;\n}\n\n.wani-kb-key-playing.wani-kb-bk {\n  border-left: 1px solid #fff;\n  border-right: 1px solid #fff;\n  border-bottom: 1px solid #fff;\n  box-shadow: 0 0 5px #def;\n}\n",Wanigui.registerModule({name:"keyboard",create:n,stylesheet:t})}.call(this);