<script>window.Alligata = {};</script>
<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="../../wani/lib/Wani.js"></script>
<script src="../../wani/sample/TriOscillator.js"></script>
<script src="../js/wanigui.js"></script>
<script src="../js/module-basic.js"></script>
<script src="../js/knob.js"></script>
<script src="../js/keyboard.js"></script>
<script>
$( function () {
});
</script>
<link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />

<body>
  <section class="container doc">
    <div class="row">
      <h1 class="page-title">wanigui<small>GUI collection for WebAudio API and <a href="http://aklaswad.github.com/wani">wani</a></small></h1>
      <div class="col-lg-4 col-md-4 col-sm-4">
        <p>alligata is a small GUI collection for WebAudio API / <a href="http://aklaswad.github.io/wani/">wani</a> users.</p>
      </div>

      <div class="col-lg-4 col-md-4 col-sm-4">
        <h3><a href="dsp-circuit-compiler.html">Wave Form Monitor</a></h3>
<a id="stop" href="#">stop</a>
          <div id="gui"></div>

<script>
$(function () {
  var synth = Wani.createModule('TriOscillator',{poly:true});
  var gui = new Wanigui(synth);
  console.log(gui);
  var $gui = gui.build();
  $('#gui').append($gui.addClass('wani-module'))
  synth.connect(Wani.getAudioContext().destination);
  var timer = setInterval( function () {
    var note = parseInt( Math.random() * 24) + 49;
    gui.instrument.noteOn(note);
    setTimeout( function (){ gui.instrument.noteOff(note); }, 4000 );
  },1000);
$('#stop').click(function () { clearInterval(timer) });



var midi = null;  // global MIDIAccess object
var MIDIMessageEventHandler = function (event) {
  console.log("msg",arguments);


      switch (event.data[0] & 0xf0) {
        case 0x90:
          if (event.data[2]!=0) {  // if velocity != 0, this is a note-on message
            gui.instrument.noteOn(event.data[1],event.data[2]/128);

            return;
          }

        case 0x80:
          gui.instrument.noteOff(event.data[1]);
          return;
      }
    }


function onMIDISuccess( midiAccess ) {

  midi = midiAccess;  // store in the global (in real usage, would probably keep in an object instance)
var inputs=midiAccess.inputs.values();
 for ( var input = inputs.next(); input && !input.done; input = inputs.next()) {
        input.value.onmidimessage = MIDIMessageEventHandler;
//        haveAtLeastOneDevice = true;
      }

function onMIDIMessage( event ) {
  var str = "MIDI message received at timestamp " + event.timestamp + "[" + event.data.length + " bytes]: ";
  for (var i=0; i<event.data.length; i++) {
    str += "0x" + event.data[i].toString(16) + " ";
  }

}
}


function onMIDIFailure(msg) {
  console.log( "Failed to get MIDI access - " + msg );
}

navigator.requestMIDIAccess().then( onMIDISuccess, onMIDIFailure );


});
</script>
      </div>
    </div>
    <footer class="credit">
      <p>written by aklaswad <a href="https://github.com/aklaswad">github</a> <a href="https://twitter.com/aklaswad">twitter</a></p>
    </footer>

  </section>
<a href="https://github.com/aklaswad/alligata" style="z-index:9999"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>
</body>


